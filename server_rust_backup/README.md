# REST API Server —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Telegram

Rust API —Å–µ—Ä–≤–µ—Ä —Å –∑–∞—â–∏—â–µ–Ω–Ω—ã–º–∏ –∞–¥–º–∏–Ω—Å–∫–∏–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Telegram OTP –∫–æ–¥—ã.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–µ –∫–æ–¥—ã –≤ Telegram
- üõ°Ô∏è –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã —Å guard middleware
- üìä SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- üöÄ –ë—ã—Å—Ç—Ä—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π (Rust + Rocket)
- üìù –í—Å–µ –æ—Ç–≤–µ—Ç—ã –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
- üë§ –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–¥–º–∏–Ω (ID –∏–∑ .env)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–°–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞:**
   - –ù–∞–π–¥–∏—Ç–µ @BotFather –≤ Telegram
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
   - –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞

2. **–£–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π Telegram ID:**
   - –ù–∞–ø–∏—à–∏—Ç–µ @userinfobot –≤ Telegram
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–∞—à ID

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Ñ–∞–π–ª:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `server/.env`
   - –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ `TELEGRAM_BOT_TOKEN`
   - –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à ID –≤ `ADMIN_TELEGRAM_ID`

```env
DATABASE_URL=sqlite:./data.db
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–æ—Ç_BotFather
ADMIN_TELEGRAM_ID=–≤–∞—à_telegram_id
ROCKET_ADDRESS=127.0.0.1
ROCKET_PORT=8000
```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
cd server
cargo run
```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/auth/request-otp`
2. –°–µ—Ä–≤–µ—Ä –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
3. –ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è **–Ω–∞ –≤–∞—à Telegram** (ID –∏–∑ .env)
4. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–¥ –Ω–∞ `/api/auth/verify-otp`
5. –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω–∫–µ

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ü—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

#### GET `/`
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ
```json
{
  "success": true,
  "data": {
    "status": "ok",
    "version": "0.1.0"
  }
}
```

#### GET `/health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "version": "0.1.0"
  }
}
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

#### POST `/api/auth/request-otp`
–ó–∞–ø—Ä–æ—Å–∏—Ç—å –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–æ–¥ (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ Telegram –Ω–∞ –≤–∞—à ID –∏–∑ .env)

**–ó–∞–ø—Ä–æ—Å:**
```json
{}
```
–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø—É—Å—Ç–æ–π POST –∑–∞–ø—Ä–æ—Å.

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "success": true,
    "message": "OTP code sent to Telegram"
  }
}
```

#### POST `/api/auth/verify-otp`
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "code": "123456"
}
```

**–û—Ç–≤–µ—Ç (—É—Å–ø–µ—Ö):**
```json
{
  "success": true,
  "data": {
    "success": true,
    "token": "abc123...",
    "message": "Authentication successful"
  }
}
```

**–û—Ç–≤–µ—Ç (–æ—à–∏–±–∫–∞):**
```json
{
  "success": true,
  "data": {
    "success": false,
    "token": null,
    "message": "Invalid or expired OTP code"
  }
}
```

### –ê–¥–º–∏–Ω—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã (—Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω)

–í—Å–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ –º–∞—Ä—à—Ä—É—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization:
```
Authorization: Bearer –≤–∞—à_—Ç–æ–∫–µ–Ω
```
–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ:
```
Authorization: –≤–∞—à_—Ç–æ–∫–µ–Ω
```

#### GET `/api/admin/info`
–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "message": "You are authenticated as admin",
    "telegram_id": 123456789,
    "user_id": 1
  }
}
```

#### GET `/api/admin/dashboard`
–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–¥–º–∏–Ω–∫–∏

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": "Welcome to admin dashboard"
}
```

#### GET `/api/admin/stats`
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Å—Å–∏–π

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "total_sessions": 10,
    "active_sessions": 3
  }
}
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
server/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ models/       # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∏ DTOs
‚îÇ   ‚îú‚îÄ‚îÄ db/           # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ auth/         # –õ–æ–≥–∏–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ guards/       # Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ telegram/     # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot API
‚îÇ   ‚îú‚îÄ‚îÄ routes/       # HTTP –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.rs       # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.rs      # –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –∞–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ public_routes.rs  # –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ main.rs       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ Cargo.toml
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`
- `id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `telegram_id` - Telegram ID (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `username` - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

### –¢–∞–±–ª–∏—Ü–∞ `otp_codes`
- `id` - ID –∫–æ–¥–∞
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `code` - 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥
- `expires_at` - –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (5 –º–∏–Ω—É—Ç)
- `used` - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ª–∏ –∫–æ–¥
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

### –¢–∞–±–ª–∏—Ü–∞ `sessions`
- `id` - ID —Å–µ—Å—Å–∏–∏
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `token` - –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ (SHA256)
- `expires_at` - –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (30 –¥–Ω–µ–π)
- `created_at` - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- OTP –∫–æ–¥—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 5 –º–∏–Ω—É—Ç
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- –¢–æ–∫–µ–Ω—ã —Å–µ—Å—Å–∏–π –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 30 –¥–Ω–µ–π
- –¢–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º UUID v4 –∏ SHA256
- –í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç JSON
- –ö–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Telegram ID –∏–∑ .env

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –° curl:

```bash
# –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–¥ (–æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –Ω–∞ –≤–∞—à Telegram)
curl -X POST http://localhost:8000/api/auth/request-otp \
  -H "Content-Type: application/json" \
  -d '{}'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
curl -X POST http://localhost:8000/api/auth/verify-otp \
  -H "Content-Type: application/json" \
  -d '{"code": "123456"}'

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω–∫–µ
curl http://localhost:8000/api/admin/info \
  -H "Authorization: Bearer –≤–∞—à_—Ç–æ–∫–µ–Ω"
```

### –° JavaScript (fetch):

```javascript
// –ó–∞–ø—Ä–æ—Å–∏—Ç—å –∫–æ–¥
const response = await fetch('http://localhost:8000/api/auth/request-otp', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({})
});

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥
const authResponse = await fetch('http://localhost:8000/api/auth/verify-otp', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ code: '123456' })
});
const { data } = await authResponse.json();
const token = data.token;

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω
const adminResponse = await fetch('http://localhost:8000/api/admin/info', {
  headers: { 'Authorization': `Bearer ${token}` }
});
```

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –∞–¥–º–∏–Ω—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

–í —Ñ–∞–π–ª–µ `src/routes/admin.rs`:

```rust
#[get("/admin/my-endpoint")]
pub async fn my_endpoint(_auth: AuthGuard) -> Json<ApiResponse<String>> {
    // _auth —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    // _auth.user.id, _auth.user.telegram_id
    Json(ApiResponse::success("Your data".to_string()))
}
```

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –≤ `main.rs`:
```rust
routes![
    routes::admin::my_endpoint,
    // ...
]
```
